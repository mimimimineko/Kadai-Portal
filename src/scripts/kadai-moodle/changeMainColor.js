
document.addEventListener('DOMContentLoaded', function(){
    //MoodleのLocalStrageに保存された設定を元に色変え
    document.documentElement.style.setProperty('--color_primary',  localStorage.getItem('mainColorbyKadaiPortal'));
});

function addColorChoiceMenu(idname){
    document.getElementById(idname).insertAdjacentHTML('beforeend', '<div class="tools_tab_content" id="tools_moodleColor_content"><h4><br>メインテーマ色変更</h4><input id="tools_moodle_default"    type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_default"class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_default"> デフォルト  </label><input id="tools_moodle_orange"    type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_orange"class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_orange"> Orange  </label><input id="tools_moodle_black"      type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_black"  class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_black">   black       </label><input id="tools_moodle_gray"       type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_gray"   class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_gray">    gray        </label><input id="tools_moodle_silver"     type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_silver" class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_silver">  silver      </label> <input id="tools_moodle_blue"       type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_blue"   class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_blue">    blue        </label><input id="tools_moodle_navy"       type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_navy"   class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_navy">    navy        </label><input id="tools_moodle_teal"       type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_teal"   class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_teal">    teal        </label><input id="tools_moodle_green"      type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_green"  class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_green">   green       </label><input id="tools_moodle_lime"       type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_lime"   class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_lime">    lime            </label><input id="tools_moodle_aqua"       type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_aqua"   class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_aqua">    aqua            </label><input id="tools_moodle_yellow"     type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_yellow" class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_yellow">  yellow          </label><input id="tools_moodle_red"        type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_red"    class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_red">     red             </label><input id="tools_moodle_fuchsia"     type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_fuchsia" class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_fuchsia">   fuchsia         </label><input id="tools_moodle_olive"      type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_olive"  class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_olive">    olive          </label><input id="tools_moodle_purple"     type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_purple" class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_purple">   purple         </label><input id="tools_moodle_maroon"     type="radio"    name="tools_moodle_color"><label id="tools_moodle_btn_maroon" class="tools_tab_moodle hvr-shutter-out-horizontal tools_moodleColor_button"     for="tools_moodle_maroon">   maroon         </label><h5 id="tools_moodle_choiceColorCodeMessage">RGBカラーコードで指定する</h5><p>↓↓↓クリックして選択↓↓↓</p><input type="color" id="tools_moodle_choiceColorCodeInput"><style>.tools_tab_moodle {position: relative;display: block;width:50%;padding: 0.50rem 0.625rem;background-color: #fff;border: 1px solid rgba(0,0,0,.125);}input[name="tools_moodle_color"] {display: none;}#tools_moodle_btn_default{border-bottom: 8px solid #75ac2d;  /*下のラインの色*/}#tools_moodle_btn_default::before{background: #75ac2d;}input:checked + #tools_moodle_btn_default {background-color: #578021;color: #fff;}#tools_moodle_btn_orange{border-bottom: 8px solid #e17400;  /*下のラインの色*/}#tools_moodle_btn_orange::before{background: #e17400;}input:checked + #tools_moodle_btn_orange {background-color: #e17400;color: #fff;}#tools_moodle_btn_black{border-bottom: 8px solid black;  /*下のラインの色*/}#tools_moodle_btn_black::before{background: black;}input:checked + #tools_moodle_btn_black {background-color: #000000;color: #fff;}#tools_moodle_btn_gray{border-bottom: 8px solid gray;  /*下のラインの色*/}#tools_moodle_btn_gray::before{background: gray;}input:checked + #tools_moodle_btn_gray {background-color: rgb(96, 95, 95);color: #fff;}#tools_moodle_btn_silver{border-bottom: 8px solid silver;  /*下のラインの色*/}#tools_moodle_btn_silver::before{background: silver;}input:checked + #tools_moodle_btn_silver {background-color: rgb(121, 121, 121);color: #fff;}#tools_moodle_btn_white{border-bottom: 8px solid white;  /*下のラインの色*/}#tools_moodle_btn_white::before{background: white;}input:checked + #tools_moodle_btn_white {background-color: rgb(245, 245, 245);color: #565656;}#tools_moodle_btn_blue{border-bottom: 8px solid blue;  /*下のラインの色*/}#tools_moodle_btn_blue::before{background: blue;}input:checked + #tools_moodle_btn_blue {background-color: rgb(0, 0, 173);color: #fff;}#tools_moodle_btn_navy{border-bottom: 8px solid navy;  /*下のラインの色*/}#tools_moodle_btn_navy::before{background: navy;}input:checked + #tools_moodle_btn_navy {background-color: rgb(0, 0, 96);color: #fff;}#tools_moodle_btn_teal{border-bottom: 8px solid teal;  /*下のラインの色*/}#tools_moodle_btn_teal::before{background: teal;}input:checked + #tools_moodle_btn_teal {background-color: rgb(0, 91, 91);color: #fff;}#tools_moodle_btn_green{border-bottom: 8px solid green;  /*下のラインの色*/}#tools_moodle_btn_green::before{background: green;}input:checked + #tools_moodle_btn_green {background-color: rgb(0, 110, 0);color: #fff;}#tools_moodle_btn_lime{border-bottom: 8px solid lime;  /*下のラインの色*/}#tools_moodle_btn_lime::before{background: lime;}input:checked + #tools_moodle_btn_lime {background-color: rgb(3, 180, 3);color: #fff;}#tools_moodle_btn_aqua{border-bottom: 8px solid aqua;  /*下のラインの色*/}#tools_moodle_btn_aqua::before{background: aqua;}input:checked + #tools_moodle_btn_aqua {background-color: rgb(0, 157, 157);color: #fff;}#tools_moodle_btn_yellow{border-bottom: 8px solid yellow;  /*下のラインの色*/}#tools_moodle_btn_yellow::before{background: yellow;color:#565656}input:checked + #tools_moodle_btn_yellow {background-color: rgb(168, 168, 0);color: #fff;}#tools_moodle_btn_red{border-bottom: 8px solid red;  /*下のラインの色*/}#tools_moodle_btn_red::before{background: red;}input:checked + #tools_moodle_btn_red {background-color: rgb(164, 0, 0);color: #fff;}#tools_moodle_btn_olive{border-bottom: 8px solid olive;  /*下のラインの色*/}#tools_moodle_btn_olive::before{background: olive;}input:checked + #tools_moodle_btn_olive {background-color: rgb(91, 91, 0);color: #fff;}#tools_moodle_btn_purple{border-bottom: 8px solid purple;  /*下のラインの色*/}#tools_moodle_btn_purple::before{background: purple;}input:checked + #tools_moodle_btn_purple {background-color: rgb(79, 0, 79);color: #fff;}/* Shutter Out Horizontal */.hvr-shutter-out-horizontal {display: inline-block;vertical-align: middle;-webkit-transform: perspective(1px) translateZ(0);transform: perspective(1px) translateZ(0);box-shadow: 0 0 1px rgba(0, 0, 0, 0);position: relative;background: #ffffff;-webkit-transition-property: color;transition-property: color;-webkit-transition-duration: 0.3s;transition-duration: 0.3s;}.hvr-shutter-out-horizontal:before {content: "";position: absolute;z-index: -1;top: 0;bottom: 0;left: 0;right: 0;background: #2098D1;-webkit-transform: scaleX(0);transform: scaleX(0);-webkit-transform-origin: 50%;transform-origin: 50%;-webkit-transition-property: transform;transition-property: transform;-webkit-transition-duration: 0.3s;transition-duration: 0.3s;-webkit-transition-timing-function: ease-out;transition-timing-function: ease-out;}.hvr-shutter-out-horizontal:hover, .hvr-shutter-out-horizontal:focus, .hvr-shutter-out-horizontal:active {color: white;}.hvr-shutter-out-horizontal:hover:before, .hvr-shutter-out-horizontal:focus:before, .hvr-shutter-out-horizontal:active:before {-webkit-transform: scaleX(1);transform: scaleX(1);}#tools_moodle_choiceColorCodeInput{width:80%;}#tools_moodle_btn_fuchsia{border-bottom: 8px solid fuchsia;  /*下のラインの色*/}#tools_moodle_btn_fuchsia::before{background: fuchsia;}input:checked + #tools_moodle_btn_fuchsia {background-color: rgb(79, 0, 79);color: #fff;}/* Shutter Out Horizontal */.hvr-shutter-out-horizontal {display: inline-block;vertical-align: middle;-webkit-transform: perspective(1px) translateZ(0);transform: perspective(1px) translateZ(0);box-shadow: 0 0 1px rgba(0, 0, 0, 0);position: relative;background: #ffffff;-webkit-transition-property: color;transition-property: color;-webkit-transition-duration: 0.3s;transition-duration: 0.3s;}.hvr-shutter-out-horizontal:before {content: "";position: absolute;z-index: -1;top: 0;bottom: 0;left: 0;right: 0;background: #2098D1;-webkit-transform: scaleX(0);transform: scaleX(0);-webkit-transform-origin: 50%;transform-origin: 50%;-webkit-transition-property: transform;transition-property: transform;-webkit-transition-duration: 0.3s;transition-duration: 0.3s;-webkit-transition-timing-function: ease-out;transition-timing-function: ease-out;}.hvr-shutter-out-horizontal:hover, .hvr-shutter-out-horizontal:focus, .hvr-shutter-out-horizontal:active {color: white;}.hvr-shutter-out-horizontal:hover:before, .hvr-shutter-out-horizontal:focus:before, .hvr-shutter-out-horizontal:active:before {-webkit-transform: scaleX(1);transform: scaleX(1);}#tools_moodle_choiceColorCodeInput{width:80%;}#tools_moodle_btn_maroon{border-bottom: 8px solid maroon;  /*下のラインの色*/}#tools_moodle_btn_maroon::before{background: maroon;}input:checked + #tools_moodle_btn_maroon {background-color: rgb(79, 0, 79);color: #fff;}/* Shutter Out Horizontal */.hvr-shutter-out-horizontal {display: inline-block;vertical-align: middle;-webkit-transform: perspective(1px) translateZ(0);transform: perspective(1px) translateZ(0);box-shadow: 0 0 1px rgba(0, 0, 0, 0);position: relative;background: #ffffff;-webkit-transition-property: color;transition-property: color;-webkit-transition-duration: 0.3s;transition-duration: 0.3s;}.hvr-shutter-out-horizontal:before {content: "";position: absolute;z-index: -1;top: 0;bottom: 0;left: 0;right: 0;background: #2098D1;-webkit-transform: scaleX(0);transform: scaleX(0);-webkit-transform-origin: 50%;transform-origin: 50%;-webkit-transition-property: transform;transition-property: transform;-webkit-transition-duration: 0.3s;transition-duration: 0.3s;-webkit-transition-timing-function: ease-out;transition-timing-function: ease-out;}.hvr-shutter-out-horizontal:hover, .hvr-shutter-out-horizontal:focus, .hvr-shutter-out-horizontal:active {color: white;}.hvr-shutter-out-horizontal:hover:before, .hvr-shutter-out-horizontal:focus:before, .hvr-shutter-out-horizontal:active:before {-webkit-transform: scaleX(1);transform: scaleX(1);}#tools_moodle_choiceColorCodeInput{width:80%;}</style><style>::-webkit-scrollbar {width: 9px;height: 10px;}::-webkit-scrollbar-track {background-color: rgba(255, 255, 255, 0.3);border-radius: 100px;}::-webkit-scrollbar-thumb {background: var(--color_primary);border-radius: 100px;width: 130px;}</style></div>');  
}

window.onload=function(){
// Mooodleサイドバーにメニューを追加する Moodleのみで動作
    console.log("Kadai-Portal:localstorageに保存されている色設定は "+localStorage.getItem('mainColorbyKadaiPortal'))
    //初回起動時に色を設定(Moodleサイトのlocalstorageに色がない場合)
    if(localStorage.getItem('mainColorbyKadaiPortal')==null){
    localStorage.setItem('mainColorbyKadaiPortal', '#e17400');
    console.log("Kadai-Portal:初回起動です。色を設定しました。")
    }
    // メインテーマ色を設定
    document.documentElement.style.setProperty('--color_primary',  localStorage.getItem('mainColorbyKadaiPortal'));
    /////Moodleサイドバーに設定画面追加
    if(document.getElementById('courseindex')){
    addColorChoiceMenu('courseindex');
    }else if(document.getElementById('block-region-side-pre')){
    addColorChoiceMenu('block-region-side-pre');
    }

    /////設定項目をクリックしたら発火、色を変える 設定も変更する
    setTimeout(function(){
        const colorButtons = [
            { id: "tools_moodle_default", color: '#75ac2d' },
            { id: "tools_moodle_orange", color: '#e17400' },
            { id: "tools_moodle_black", color: 'black' },
            { id: "tools_moodle_gray", color: 'gray' },
            { id: "tools_moodle_silver", color: 'silver' },
            { id: "tools_moodle_blue", color: 'blue' },
            { id: "tools_moodle_navy", color: 'navy' },
            { id: "tools_moodle_teal", color: 'teal' },
            { id: "tools_moodle_green", color: 'green' },
            { id: "tools_moodle_lime", color: 'lime' },
            { id: "tools_moodle_aqua", color: 'aqua' },
            { id: "tools_moodle_yellow", color: 'yellow' },
            { id: "tools_moodle_red", color: 'red' },
            { id: "tools_moodle_fuchsia", color: 'fuchsia' },
            { id: "tools_moodle_olive", color: 'olive' },
            { id: "tools_moodle_purple", color: 'purple' },
            { id: "tools_moodle_maroon", color: 'maroon' }
          ];
          
          colorButtons.forEach(button => {
            const element = document.getElementById(button.id);
            element.addEventListener("click", function () {
              document.documentElement.style.setProperty('--color_primary', button.color);
              localStorage.setItem('mainColorbyKadaiPortal', button.color);
            });
          });
          
    // document.getElementById("tools_moodle_default").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','#75ac2d');    localStorage.setItem('mainColorbyKadaiPortal','#75ac2d');});
    // document.getElementById("tools_moodle_orange").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','#e17400');     localStorage.setItem('mainColorbyKadaiPortal','#e17400'); });
    // document.getElementById("tools_moodle_black").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','black');        localStorage.setItem('mainColorbyKadaiPortal','black'); });
    // document.getElementById("tools_moodle_gray").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','gray');          localStorage.setItem('mainColorbyKadaiPortal','gray');  });
    // document.getElementById("tools_moodle_silver").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','silver');      localStorage.setItem('mainColorbyKadaiPortal','silver');});
    // document.getElementById("tools_moodle_blue").addEventListener("click", function(){document.documentElement.style.setProperty('--color_primary','blue');         localStorage.setItem('mainColorbyKadaiPortal','blue'); });
    // document.getElementById("tools_moodle_navy").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','navy');          localStorage.setItem('mainColorbyKadaiPortal','navy');  });
    // document.getElementById("tools_moodle_teal").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','teal');          localStorage.setItem('mainColorbyKadaiPortal','teal');  });
    // document.getElementById("tools_moodle_green").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','green');        localStorage.setItem('mainColorbyKadaiPortal','green'); });
    // document.getElementById("tools_moodle_lime").addEventListener("click", function(){document.documentElement.style.setProperty('--color_primary','lime');         localStorage.setItem('mainColorbyKadaiPortal','lime'); });
    // document.getElementById("tools_moodle_aqua").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','aqua');          localStorage.setItem('mainColorbyKadaiPortal','aqua');   });
    // document.getElementById("tools_moodle_yellow").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','yellow');      localStorage.setItem('mainColorbyKadaiPortal','yellow'); });
    // document.getElementById("tools_moodle_red").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','red');            localStorage.setItem('mainColorbyKadaiPortal','red');     });  
    // document.getElementById("tools_moodle_fuchsia").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','fuchsia');      localStorage.setItem('mainColorbyKadaiPortal','fuchsia'); });
    // document.getElementById("tools_moodle_olive").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','olive');        localStorage.setItem('mainColorbyKadaiPortal','olive'); });
    // document.getElementById("tools_moodle_purple").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','purple');      localStorage.setItem('mainColorbyKadaiPortal','purple'); });
    // document.getElementById("tools_moodle_maroon").addEventListener("click",function(){document.documentElement.style.setProperty('--color_primary','maroon');      localStorage.setItem('mainColorbyKadaiPortal','maroon'); });
    document.getElementById("tools_moodle_choiceColorCodeInput").addEventListener("input",function(){
        let moodleColorCodeChoicebox=document.getElementById("tools_moodle_choiceColorCodeInput").value;
        document.documentElement.style.setProperty('--color_primary',moodleColorCodeChoicebox);  
        localStorage.setItem('mainColorbyKadaiPortal',moodleColorCodeChoicebox);
        // chrome.runtime.sendMessage({greeting: "messageFromPopup!!",color:moodleColorCodeChoicebox}, function(response) {});
    });
    },500);
}
